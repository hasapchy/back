# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ - –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (82 –≤—Ö–æ–∂–¥–µ–Ω–∏—è)
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ–∑–¥–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω:
```php
$userUuid = $this->requireAuthenticatedUserId();
if ($userUuid instanceof \Illuminate\Http\JsonResponse) {
    return $userUuid;
}
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–µ—Ç–æ–¥:
```php
protected function getAuthenticatedUserIdOrFail()
{
    $userUuid = $this->requireAuthenticatedUserId();
    if ($userUuid instanceof \Illuminate\Http\JsonResponse) {
        abort(401); // –∏–ª–∏ throw new AuthenticationException
    }
    return $userUuid;
}
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

### 2. –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (330 –≤—Ö–æ–∂–¥–µ–Ω–∏–π response()->json())
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥—ã `successResponse()`, `notFoundResponse()`, `forbiddenResponse()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ 6 –º–µ—Å—Ç–∞—Ö, —Ö–æ—Ç—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤–µ–∑–¥–µ.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `OrderController.php:26` - `return $this->paginatedResponse($items);` ‚úÖ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- `ProductController.php:36` - `return response()->json($items);` ‚ùå –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `return $this->successResponse($items);`

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `response()->json()` –Ω–∞ –º–µ—Ç–æ–¥—ã –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ë–î –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `ClientController` –∏ `CurrencyHistoryController`, —Ö–æ—Ç—è –Ω—É–∂–Ω—ã –≤–æ –º–Ω–æ–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:
- `OrderController::store()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `SaleController::store()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `TransactionsController::store()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- `WarehouseReceiptController::store()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –û–±–µ—Ä–Ω—É—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `DB::transaction()`.

---

## üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `warehouse_id` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ 5+ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- `client_id` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ 10+ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- `products.*` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ 4+ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å FormRequest –∫–ª–∞—Å—Å—ã:
```php
// app/Http/Requests/StoreOrderRequest.php
class StoreOrderRequest extends FormRequest
{
    public function rules() { /* ... */ }
}
```

---

### 5. –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `OrderController::store()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `['message' => '...']` —Å –∫–æ–¥–æ–º 400
- `ProductController::store()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `['message' => '...', 'item' => $product]` —Å –∫–æ–¥–æ–º 200
- `SaleController::store()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `['message' => '...']` —Å –∫–æ–¥–æ–º 201

**–†–µ—à–µ–Ω–∏–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
```php
// –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
return $this->successResponse($data, '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 201);

// –û—à–∏–±–∫–∞
return $this->successResponse(null, '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞', 400);
// –∏–ª–∏ –ª—É—á—à–µ:
return response()->json(['message' => '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞'], 400);
```

---

### 6. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ (123 –≤—Ö–æ–∂–¥–µ–Ω–∏—è)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ.

**–ü—Ä–∏–º–µ—Ä:**
```php
CacheService::invalidateOrdersCache();
CacheService::invalidateWarehouseStocksCache();
CacheService::invalidateProductsCache();
CacheService::invalidateClientsCache();
```

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –º–µ—Ç–æ–¥—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:
```php
// –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
public function createItem($data) {
    $item = /* ... */;
    event(new OrderCreated($item)); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
    return $item;
}
```

---

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `WarehouseController` - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Å–∫–ª–∞–¥—É
- `ProductController` - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `CategoriesController` - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ Laravel:
```php
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
$this->authorize('create', Product::class);
```

---

### 8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `auth('api')->user()` –≤–º–µ—Å—Ç–æ –º–µ—Ç–æ–¥–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –≤–º–µ—Å—Ç–æ `getAuthenticatedUser()`.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `AppController::getCurrencyList()` - `auth('api')->user()`
- `CommentController::index()` - `auth('api')->user()`
- `UserCompanyController::getCurrentCompany()` - `Auth::user()`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$this->getAuthenticatedUser()` –∏–ª–∏ `$this->requireAuthenticatedUser()`.

---

## üü¢ –£–ª—É—á—à–µ–Ω–∏—è

### 9. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –∏ —Å—Ç—Ä–æ–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `OrderController::store()` - `'status_id' => 1` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)
- `ProjectsController::store()` - `'status_id' => 1` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞)

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –º–æ–¥–µ–ª—è—Ö –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥–µ:
```php
// app/Models/Order.php
public const STATUS_NEW = 1;
public const STATUS_IN_PROGRESS = 2;
```

---

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥—ã –Ω–µ –∏–º–µ—é—Ç —Ç–∏–ø–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã:
```php
public function store(Request $request): JsonResponse
{
    // ...
}
```

---

### 11. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ –∫–∞—Å—Å—É
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∫–∞—Å—Å—É –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

**–ü—Ä–∏–º–µ—Ä:**
```php
$userHasPermissionToCashRegister = $this->itemsRepository->userHasPermissionToCashRegister($userUuid, $request->cash_id);
if (!$userHasPermissionToCashRegister) {
    return response()->json(['message' => '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–∞—Å—Å—É'], 403);
}
```

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ middleware –∏–ª–∏ –º–µ—Ç–æ–¥ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
```php
protected function requireCashRegisterAccess(int $cashId): void
{
    $user = $this->requireAuthenticatedUser();
    if (!$this->itemsRepository->userHasPermissionToCashRegister($user->id, $cashId)) {
        abort(403, '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–∞—Å—Å—É');
    }
}
```

---

### 12. –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ try-catch
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è try-catch, –≤ –¥—Ä—É–≥–∏—Ö - –Ω–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥.

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å FormRequest –∫–ª–∞—Å—Å—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
5. ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
6. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞ –≤ —Å–æ–±—ã—Ç–∏—è/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–ª—É—á—à–µ–Ω–∏—è):
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤
9. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

## –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –î–æ:
```php
public function store(Request $request)
{
    $userUuid = $this->requireAuthenticatedUserId();
    if ($userUuid instanceof \Illuminate\Http\JsonResponse) {
        return $userUuid;
    }

    $request->validate([/* ... */]);

    $item = $this->itemsRepository->createItem($data);

    if (!$item) {
        return response()->json(['message' => '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è'], 400);
    }

    CacheService::invalidateOrdersCache();
    CacheService::invalidateClientsCache();

    return response()->json(['message' => '–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ'], 200);
}
```

### –ü–æ—Å–ª–µ:
```php
public function store(StoreOrderRequest $request): JsonResponse
{
    $userUuid = $this->getAuthenticatedUserIdOrFail();

    $item = DB::transaction(function () use ($request, $userUuid) {
        return $this->itemsRepository->createItem([
            'user_id' => $userUuid,
            // ...
        ]);
    });

    return $this->successResponse($item, '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 201);
}
```

---

## –ú–µ—Ç—Ä–∏–∫–∏

- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:** 82 –≤—Ö–æ–∂–¥–µ–Ω–∏—è
- **–ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:** 330 –≤—Ö–æ–∂–¥–µ–Ω–∏–π `response()->json()`
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞:** 123 –≤—Ö–æ–∂–¥–µ–Ω–∏—è
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ë–î:** ~15 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ~20+ –º–µ—Å—Ç

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –°–æ–∑–¥–∞—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å –º–µ—Ç–æ–¥–∞–º–∏-—Ö–µ–ª–ø–µ—Ä–∞–º–∏
2. –°–æ–∑–¥–∞—Ç—å FormRequest –∫–ª–∞—Å—Å—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
4. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
5. –í—ã–Ω–µ—Å—Ç–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞ –≤ —Å–æ–±—ã—Ç–∏—è/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏


